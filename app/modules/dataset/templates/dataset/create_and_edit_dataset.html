{% extends "base_template.html" %}

{% set title = "Upload dataset" %}

{% block breadcrumb %}

<ol class="breadcrumb text-muted fs-6 fw-semibold">
    <li class="breadcrumb-item"><a href="/" class="">Home</a></li>
    <li class="breadcrumb-item text-muted">Upload dataset</li>
</ol>

{% endblock %}

{% block content %}

<div class="stepper stepper-pills stepper-column d-flex flex-column flex-xl-row flex-row-fluid gap-10" id="stepper_upload_dataset">
    <!--begin::Aside-->
    <div class="card d-flex justify-content-center justify-content-xl-start flex-row-auto w-100 w-xl-300px w-xxl-400px">
        <!--begin::Wrapper-->
        <div class="card-body px-6 px-lg-10 px-xxl-15 py-20">
            <!--begin::Nav-->

            <!-- Left menu-->

            <div class="stepper-nav">
                <!--begin::Step 1-->
                <div class="stepper-item current" data-kt-stepper-element="nav">
                    <!--begin::Wrapper-->
                    <div class="stepper-wrapper">
                        <!--begin::Icon-->
                        <div class="stepper-icon w-40px h-40px">
                            <i class="ki-duotone ki-check fs-2 stepper-check"></i>
                            <span class="stepper-number">1</span>
                        </div>
                        <!--end::Icon-->
                        <!--begin::Label-->
                        <div class="stepper-label">
                            <h3 class="stepper-title">Setup dataset type</h3>
                            <div id="step_1_summary" class="stepper-desc fw-semibold"></div>
                        </div>
                        <!--end::Label-->
                    </div>
                    <!--end::Wrapper-->
                    <!--begin::Line-->
                    <div class="stepper-line h-40px"></div>
                    <!--end::Line-->
                </div>
                <!--end::Step 1-->
                <!--begin::Step 2-->
                <div class="stepper-item" data-kt-stepper-element="nav">
                    <!--begin::Wrapper-->
                    <div class="stepper-wrapper">
                        <!--begin::Icon-->
                        <div class="stepper-icon w-40px h-40px">
                            <i class="ki-duotone ki-check fs-2 stepper-check"></i>
                            <span class="stepper-number">2</span>
                        </div>
                        <!--end::Icon-->
                        <!--begin::Label-->
                        <div class="stepper-label">
                            <h3 class="stepper-title">Upload UVL files</h3>
                            <div id="step_2_summary" class="stepper-desc fw-semibold"></div>
                        </div>
                        <!--end::Label-->
                    </div>
                    <!--end::Wrapper-->
                    <!--begin::Line-->
                    <div class="stepper-line h-40px"></div>
                    <!--end::Line-->
                </div>
                <!--end::Step 2-->
                <!--begin::Step 3-->
                <div class="stepper-item" data-kt-stepper-element="nav">
                    <!--begin::Wrapper-->
                    <div class="stepper-wrapper">
                        <!--begin::Icon-->
                        <div class="stepper-icon w-40px h-40px">
                            <i class="ki-duotone ki-check fs-2 stepper-check"></i>
                            <span class="stepper-number">3</span>
                        </div>
                        <!--end::Icon-->
                        <!--begin::Label-->
                        <div class="stepper-label">
                            <h3 class="stepper-title">Setup dataset info</h3>
                        </div>
                        <!--end::Label-->
                    </div>
                    <!--end::Wrapper-->
                    <!--begin::Line-->
                    <div class="stepper-line h-40px"></div>
                    <!--end::Line-->
                </div>
                <!--end::Step 3-->
                <!--begin::Step 4-->
                <div class="stepper-item" data-kt-stepper-element="nav">
                    <!--begin::Wrapper-->
                    <div class="stepper-wrapper">
                        <!--begin::Icon-->
                        <div class="stepper-icon w-40px h-40px">
                            <i class="ki-duotone ki-check fs-2 stepper-check"></i>
                            <span class="stepper-number">4</span>
                        </div>
                        <!--end::Icon-->
                        <!--begin::Label-->
                        <div class="stepper-label">
                            <h3 class="stepper-title">Setup authors</h3>
                        </div>
                        <!--end::Label-->
                    </div>
                    <!--end::Wrapper-->
                    <!--begin::Line-->
                    <div class="stepper-line h-40px"></div>
                    <!--end::Line-->
                </div>
                <!--end::Step 4-->
                <!--begin::Step 5-->
                <div class="stepper-item mark-completed" data-kt-stepper-element="nav">
                    <!--begin::Wrapper-->
                    <div class="stepper-wrapper">
                        <!--begin::Icon-->
                        <div class="stepper-icon w-40px h-40px">
                            <i class="ki-duotone ki-check fs-2 stepper-check"></i>
                            <span class="stepper-number">5</span>
                        </div>
                        <!--end::Icon-->
                        <!--begin::Label-->
                        <div class="stepper-label">
                            <h3 class="stepper-title">Upload dataset</h3>
                        </div>
                        <!--end::Label-->
                    </div>
                    <!--end::Wrapper-->
                </div>
                <!--end::Step 5-->
            </div>
            <!--end::Nav-->
        </div>
        <!--end::Wrapper-->
    </div>
    <!--begin::Aside-->
    <!--begin::Content-->
    <div class="card d-flex flex-row-fluid flex-center">
        <!--begin::Form-->
        <div class="card-body py-20 w-100 mw-xl-700px px-9" novalidate="novalidate">

            <div class="current" data-kt-stepper-element="content">
                <!--begin::Wrapper-->
                <div class="w-100">
                    <!--begin::Heading-->
                    <div class="pb-10 pb-lg-15">
                        <h2 class="fw-bold d-flex align-items-center text-gray-900">Setup dataset type</h2>
                        <div class="text-muted fw-semibold fs-6">
                            With this option you can control the visibility of your dataset. It is very useful if, for example, your dataset is not complete or your paper is in a double-blind review process.
                        </div>
                    </div>
                    <!--end::Heading-->
                    <!--begin::Input group-->
                    <div class="fv-row">
                        <div class="row">

                            <div class="col-lg-12">
                                <input type="radio" class="btn-check" name="dataset_type" value="zenodo" checked="checked" id="zenodo" />
                                <label class="btn btn-outline btn-outline-dashed btn-active-light-primary p-7 d-flex align-items-center mb-10" for="zenodo">
                                    <i class="ki-duotone ki-check-circle fs-3x me-5">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                        <span class="path3"></span>
                                        <span class="path4"></span>
                                        <span class="path5"></span>
                                    </i>
                                    <span class="d-block fw-semibold text-start">
                                        <span class="text-gray-900 fw-bold d-block fs-4 mb-2">Permanent upload to Zenodo</span>
                                        <span class="text-muted fw-semibold fs-6">Your dataset is ready to be uploaded to Zenodo permanently</span>
                                    </span>
                                </label>
                            </div>

                            <div class="col-lg-12">
                                <input type="radio" class="btn-check" name="dataset_type" value="zenodo_anonymous" id="zenodo_anonymous" />
                                <label class="btn btn-outline btn-outline-dashed btn-active-light-primary p-7 d-flex align-items-center mb-10" for="zenodo_anonymous">
                                    <i class="ki-duotone ki-eye-slash fs-3x me-5">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                        <span class="path3"></span>
                                        <span class="path4"></span>
                                    </i>
                                    <span class="d-block fw-semibold text-start">
                                        <span class="text-gray-900 fw-bold d-block fs-4 mb-2">Permanent (anonymous) upload to Zenodo</span>
                                        <span class="text-muted fw-semibold fs-6">
                                            Your dataset is ready to be uploaded to Zenodo permanently, but you are currently in a double-blind peer review process. Therefore, you need the dataset to remain anonymous until the paper is published.</span>
                                    </span>
                                </label>
                            </div>

                            <div class="col-lg-12">
                                <input type="radio" class="btn-check" name="dataset_type" value="draft" id="draft" />
                                <label class="btn btn-outline btn-outline-dashed btn-active-light-primary p-7 d-flex align-items-center mb-10" for="draft">
                                    <i class="ki-duotone ki-pencil fs-3x me-5">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                    </i>
                                    <span class="d-block fw-semibold text-start">
                                        <span class="text-gray-900 fw-bold d-block fs-4 mb-2">Draft</span>
                                        <span class="text-muted fw-semibold fs-6">
                                            You want to start uploading the dataset but it's not ready yet - no problem! You can complete it later. Your dataset will not be uploaded to Zenodo, it will be saved locally and will not be visible to the public.                                    </span>
                                </label>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!--end::Step 1-->
            <!--begin::Step 2-->
            <div data-kt-stepper-element="content">
                <!--begin::Wrapper-->
                <div class="w-100">
                    <!--begin::Heading-->
                    <div class="pb-10 pb-lg-15">
                        <!--begin::Title-->
                        <h2 class="fw-bold text-gray-900">Upload UVL files</h2>
                        <div class="text-muted fw-semibold fs-6">
                            You can upload as many UVL files as you want.
                            All files will be automatically checked by our built-in syntax analyzer to ensure they are valid.
                        </div>
                    </div>

                    <div class="mb-0 fv-row">

                        <form class="form" action="#" method="post">
                            <!--begin::Input group-->
            
                                <!--begin::Col-->
                                    <!--begin::Dropzone-->
                                    <div class="dropzone dropzone-queue mb-2" id="uvl_dropzone">
                                        <!--begin::Controls-->
                                        <div class="dropzone-panel mb-lg-0 mb-2">
                                            <a class="dropzone-select btn btn-sm btn-primary me-2">Attach files</a>
                                                <a id="clear-all-btn" href="javascript:void(0)" class="btn btn-sm btn-danger">Clear all</a>
                                        </div>
                                        <!--end::Controls-->

                                        <div class="dropzone-error" data-dz-errormessage></div>
            
                                        <!--begin::Items-->
                                        <div class="dropzone-items wm-200px">
                                            <div class="dropzone-item" style="display:none">
                                                <!--begin::File-->
                                                <div class="dropzone-file">
                                                    <div class="dropzone-filename" title="some_image_file_name.jpg">
                                                        <span data-dz-name>some_image_file_name.jpg</span>
                                                        <strong>(<span data-dz-size>340kb</span>)</strong>
                                                    </div>
            
                                                    
                                                </div>
                                                <!--end::File-->
            
                                                <!--begin::Progress-->
                                                <div class="dropzone-progress">
                                                    <div class="progress">
                                                        <div
                                                            class="progress-bar bg-primary"
                                                            role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" data-dz-uploadprogress>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--end::Progress-->
            
                                                <!--begin::Toolbar-->
                                                <div class="dropzone-toolbar">
                                                    <span class="dropzone-delete" data-dz-remove><i class="bi bi-x fs-1"></i></span>
                                                </div>
                                                <!--end::Toolbar-->
                                            </div>
                                        </div>
                                        <!--end::Items-->
                                    </div>
                                    <!--end::Dropzone-->

                                    <!--begin::Hint-->
                                    <span class="form-text text-muted">The maximum file size is 100 MB and the maximum number of files is 20. If you wish to upload more files, please prepare a ZIP or tarball folder with your UVL models.</span>
                                    <!--end::Hint-->
                                
                                <!--end::Col-->
                            
                            <!--end::Input group-->
                        </form>

                    </div>

                </div>
                <!--end::Wrapper-->
            </div>
            <!--end::Step 2-->
            <!--begin::Step 3-->
            <div data-kt-stepper-element="content">
                <!--begin::Wrapper-->
                <div class="w-100">
                    <!--begin::Heading-->
                    <div class="pb-10 pb-lg-12">
                        <!--begin::Title-->
                        <h2 class="fw-bold text-gray-900">Setup dataset info</h2>
                        <!--end::Title-->
                        <!--begin::Notice-->
                        <div class="text-muted fw-semibold fs-6">
                            Provide a title, description, publication details and tags to complete your dataset metadata.
                        </div>
                        <!--end::Notice-->
                    </div>
                    <!--end::Heading-->
                    <!--begin::Input group-->


                    <div class="fv-row mb-10">
                        <label class="form-label required">Title</label>
                        <input type="text" name="title" class="form-control mb-2" placeholder="Enter a title">
                        <div class="text-muted fs-7">Set a dataset title. Recommended to be simple and precise keywords.</div>
                    </div>
        
                    <div class="fv-row mb-10">
                        <label class="form-label required">Description</label>
                        <div data-bs-theme="light">
                            <textarea name="description" id="dataset_editor">
                            </textarea>
                        </div>
                    </div>

                    <div class="fv-row mb-10">
                        
                        <label class="form-label">Publication type</label>
                        <span class="ms-1" data-bs-toggle="tooltip" title="In Zenodo, it categorizes uploaded content (articles, datasets, software, presentations, etc.) to simplify organization and discovery">
                            <i class="ki-duotone ki-information-5 text-gray-500 fs-6">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                            </i>
                        </span>

                        <select name="{{ form.publication_type.name }}" 
                                class="form-select form-select-lg form-select-solid" 
                                data-control="select2" 
                                data-placeholder="Select a publication type..." 
                                data-allow-clear="false" 
                                data-hide-search="false">
                            <option></option>
                            {% for value, label in form.publication_type.choices %}
                                <option value="{{ value }}" 
                                        {% if form.publication_type.data == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>
                        
                    </div>

                    <div class="fv-row mb-10">
                        <label class="form-label">Publication DOI</label>
                        <span class="ms-1" data-bs-toggle="tooltip" title="If this dataset is already associated with a publication, enter the DOI resource so that it can be identified">
                            <i class="ki-duotone ki-information-5 text-gray-500 fs-6">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                            </i>
                        </span>
                        <input name="publication_doi" class="form-control form-control-lg form-control-solid">
                    </div>

                    <div class="fv-row mb-10">
                        <label class="form-label">Tags</label>
                        <span class="ms-1" data-bs-toggle="tooltip" title="Define keywords that are representative of your dataset. This will help the search">
                            <i class="ki-duotone ki-information-5 text-gray-500 fs-6">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                            </i>
                        </span>
                        <input class="form-control form-control-solid" placeholder="Separate tags by commas" id="tags"/>
                    </div>

                </div>
                <!--end::Wrapper-->
            </div>
            <!--end::Step 3-->
            <!--begin::Step 4-->
            <div data-kt-stepper-element="content">
                <!--begin::Wrapper-->
                <div class="w-100">

                    <div class="pb-10 pb-lg-15">
                        <h2 class="fw-bold text-gray-900">Setup authors</h2>
                        <div class="text-muted fw-semibold fs-6">
                            Add the authors of the dataset, including their name, affiliation and ORCID if available.
                        </div>
                    </div>

                    <div class="row draggable-zone" id="authors-container" tabindex="0">
            
                    </div>

                    <div class="mb-0 fv-row">
                        <button type="button" id="add-author-btn" class="btn btn-lg btn-light-primary me-3">
                            <i class="ki-duotone ki-plus-square fs-4 me-1">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                            </i>Add author</button>
                            <button type="button" id="add-myself-btn" class="btn btn-lg btn-light-success me-3">
    <i class="ki-duotone ki-user fs-4 me-1">
        <span class="path1"></span>
        <span class="path2"></span>
    </i>Add myself
</button>
                    </div>
                    

                </div>
                <!--end::Wrapper-->
            </div>
            <!--end::Step 4-->
            <!--begin::Step 5-->
            <div data-kt-stepper-element="content">
                <!--begin::Wrapper-->
                <div class="w-100">
                    <!--begin::Heading-->
                    <div class="pb-8 pb-lg-10">
                        <!--begin::Title-->
                        <h2 class="fw-bold text-gray-900">Upload dataset</h2>
                        <!--end::Title-->
                    </div>
                    <!--end::Heading-->
                    <!--begin::Body-->
                    <div class="mb-0">

                        <div id="summary">

                        </div>

                    </div>
                    <!--end::Body-->
                </div>
                <!--end::Wrapper-->
            </div>
            <!--end::Step 5-->
            <div id="upload-error" class="alert alert-danger mt-5 d-none" role="alert"></div>
            <!--begin::Actions-->
            <div class="d-flex flex-stack pt-10">
                <!--begin::Wrapper-->
                <div class="mr-2">
                    <button type="button" class="btn btn-lg btn-light-primary me-3" data-kt-stepper-action="previous">
                    <i class="ki-duotone ki-arrow-left fs-4 me-1">
                        <span class="path1"></span>
                        <span class="path2"></span>
                    </i>Back</button>
                </div>
                <!--end::Wrapper-->
                <!--begin::Wrapper-->
                <div>
                    <button type="button" class="btn btn-lg btn-primary me-3" data-kt-stepper-action="submit">
                        <span class="indicator-label">Submit 
                        <i class="ki-duotone ki-arrow-right fs-3 ms-2 me-0">
                            <span class="path1"></span>
                            <span class="path2"></span>
                        </i></span>
                        <span class="indicator-progress">Please wait... 
                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                    </button>
                    <button type="button" class="btn btn-lg btn-primary" data-kt-stepper-action="next" id="continue_button">Continue
                    <i class="ki-duotone ki-arrow-right fs-4 ms-1 me-0">
                        <span class="path1"></span>
                        <span class="path2"></span>
                    </i></button>
                </div>
                <!--end::Wrapper-->
            </div>
            <!--end::Actions-->
        </div>
        <!--end::Form-->
    </div>
    <!--end::Content-->
</div>

{% endblock %}
    
{% block scripts %}

<script src="{{ url_for('hubfile.assets', subfolder='dist', filename='hubfile.bundle.js') }}"></script>
<script src="{{ url_for('dataset.assets', subfolder='dist', filename='dataset.bundle.js') }}"></script>


<script id="author-template" type="x-tmpl-mustache">
<div class="col-lg-12 draggable mb-10" tabindex="0" id="author-[[id]]">
    <div class="card card-bordered shadow-sm">
        <div class="card-header">
            <div class="card-toolbar">
                <a href="#" class="btn btn-icon btn-sm btn-hover-light-primary draggable-handle">
                    <i class="ki-duotone ki-abstract-14 fs-2x">
                        <span class="path1"></span><span class="path2"></span>
                    </i>
                </a>
            </div>
            <div class="card-title">
                <button type="button" class="btn btn-sm btn-light-danger me-3 remove-author" data-id="[[id]]">
                    <i class="ki-duotone ki-minus-square fs-4 me-1">
                        <span class="path1"></span><span class="path2"></span><span class="path3"></span>
                    </i>Remove author
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Name *</label>
                    <input type="text" name="authors[[index]][name]" 
                           class="form-control author-name" 
                           placeholder="Enter name" required>
                    <div class="invalid-feedback"></div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Affiliation</label>
                    <input type="text" name="authors[[index]][affiliation]" 
                           class="form-control author-affiliation" 
                           placeholder="Enter affiliation">
                    <div class="invalid-feedback"></div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-12">
                    <label class="form-label">ORCID</label>
                    <input type="text" name="authors[[index]][orcid]" 
                           class="form-control orcid-input" 
                           placeholder="0000-0000-0000-0000">
                    <div class="invalid-feedback"></div>
                </div>
            </div>
        </div>
    </div>
</div>
</script>

{% endblock %}